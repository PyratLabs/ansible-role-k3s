---

- name: Ensure that the manifests directory exists
  ansible.builtin.file:
    state: directory
    path: "{{ k3s_server_manifests_dir }}"
    mode: 0755

- name: Deploy the kube-vip RBAC manifest to k3s manifest directory
  ansible.builtin.template:
    src: "kube-vip-rbac.yaml.j2"
    dest: "{{ k3s_server_manifests_dir }}/kube-vip-rbac.yaml"
    mode: 0644
  when:
  - kubevip_rbac is defined
  - kubevip_rbac

- name: Deploy the kube-vip daemonset to k3s manifest directory
  ansible.builtin.template:
    src: "kube-vip-daemonset.yaml.j2"
    dest: "{{ k3s_server_manifests_dir }}/kube-vip-daemonset.yaml"
    mode: 0644
